<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAPTCHA Verification System</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f6f8;
            color: #1a1a1a;
            line-height: 1.5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 2rem;
        }
        .captcha-container {
            background-color: #ffffff;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            padding: 2.5rem;
            max-width: 500px;
            width: 100%;
            transition: box-shadow 0.3s ease, transform 0.3s ease;
        }
        .captcha-container:hover {
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
            transform: translateY(-4px);
        }
        #captcha-canvas {
            border: 2px solid #dee2e6;
            background-color: #f8f9fa;
            border-radius: 8px;
            width: 100%;
            height: 100px;
            margin-bottom: 1.5rem;
            display: block;
        }
        .form-control {
            border-radius: 8px;
            font-size: 1rem;
            padding: 0.875rem;
            border: 1px solid #ced4da;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .form-control:focus {
            border-color: #0052cc;
            box-shadow: 0 0 0 0.25rem rgba(0, 82, 204, 0.2);
        }
        .btn-primary {
            background-color: #0052cc;
            border-color: #0052cc;
            font-weight: 500;
            padding: 0.875rem 2rem;
            border-radius: 8px;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .btn-primary:hover {
            background-color: #003d99;
            border-color: #003d99;
            transform: translateY(-2px);
        }
        .btn-secondary {
            background-color: #6c757d;
            border-color: #6c757d;
            font-weight: 500;
            padding: 0.875rem 2rem;
            border-radius: 8px;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
            border-color: #5a6268;
            transform: translateY(-2px);
        }
        .word-options .btn {
            margin: 0.5rem;
            font-size: 0.95rem;
            border-radius: 8px;
            padding: 0.5rem 1.25rem;
            border: 1px solid #ced4da;
            background-color: #f8f9fa;
            transition: background-color 0.3s ease, transform 0.2s ease, border-color 0.3s ease;
        }
        .word-options .btn:hover {
            background-color: #e9ecef;
            border-color: #0052cc;
            transform: translateY(-2px);
        }
        #result {
            font-weight: 500;
            margin-top: 1.5rem;
            text-align: center;
            font-size: 1.1rem;
            padding: 0.75rem;
            border-radius: 8px;
        }
        .text-success {
            background-color: #e6f4ea;
            color: #2e7d32;
        }
        .text-danger {
            background-color: #fce4e4;
            color: #d32f2f;
        }
        h2 {
            font-size: 2rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 2rem;
            text-align: center;
        }
        .form-label {
            font-weight: 500;
            color: #1a1a1a;
            margin-bottom: 0.5rem;
        }
        .form-text {
            font-size: 0.9rem;
            color: #495057;
        }
        @media (max-width: 576px) {
            .captcha-container {
                padding: 1.5rem;
            }
            #captcha-canvas {
                height: 80px;
            }
            .btn-primary, .btn-secondary {
                padding: 0.75rem 1.5rem;
            }
            h2 {
                font-size: 1.5rem;
            }
        }
        /* Accessibility improvements */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }
        /* Loading animation for buttons */
        .btn-loading::after {
            content: '';
            display: inline-block;
            width: 1rem;
            height: 1rem;
            margin-left: 0.5rem;
            border: 2px solid #fff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="captcha-container">
        <h2>CAPTCHA Verification System</h2>
        <div class="mb-4">
            <label for="captcha-canvas" class="form-label sr-only">CAPTCHA Image</label>
            <canvas id="captcha-canvas" width="240" height="100" aria-describedby="captcha-instructions"></canvas>
            <small id="captcha-instructions" class="form-text">Enter the text shown in the image below.</small>
        </div>
        <div class="mb-4">
            <label for="captcha-input" class="form-label">Enter CAPTCHA Text</label>
            <input type="text" id="captcha-input" class="form-control" placeholder="Enter text" aria-label="CAPTCHA text input" required>
        </div>
        <div class="d-flex justify-content-between mb-4">
            <button id="refresh-btn" class="btn btn-secondary">Refresh</button>
            <button id="submit-btn" class="btn btn-primary">Verify</button>
        </div>
        <div id="word-recognition" class="mb-4">
            <label class="form-label">Select the Real Word</label>
            <div id="word-options" class="word-options d-flex flex-wrap justify-content-center"></div>
        </div>
        <div id="result" role="alert"></div>
    </div>

    <!-- Bootstrap 5 JS (with Popper.js) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        const canvas = document.getElementById('captcha-canvas'); // Fixed typo: changed 'captcha-grad' to 'captcha-canvas'
        const ctx = canvas.getContext('2d');
        const captchaInput = document.getElementById('captcha-input');
        const refreshBtn = document.getElementById('refresh-btn');
        const submitBtn = document.getElementById('submit-btn');
        const wordOptions = document.getElementById('word-options');
        const result = document.getElementById('result');

        let captchaText = '';

        // Generate random string for CAPTCHA
        function generateCaptchaText(length) {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        // Draw CAPTCHA with distortion and noise
        function drawCaptcha() {
            captchaText = generateCaptchaText(6);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw distorted text
            ctx.font = '34px Inter, Arial, sans-serif';
            ctx.fillStyle = '#1a1a1a';
            for (let i = 0; i < captchaText.length; i++) {
                ctx.save();
                ctx.translate(40 + i * 32, 60);
                ctx.rotate((Math.random() - 0.5) * 0.3); // Reduced rotation for clarity
                ctx.scale(1, 1 + (Math.random() - 0.5) * 0.2); // Subtle scaling
                ctx.fillText(captchaText[i], 0, 0);
                ctx.restore();
            }

            // Add noise (random lines and dots)
            for (let i = 0; i < 5; i++) {
                ctx.beginPath();
                ctx.moveTo(Math.random() * canvas.width, Math.random() * canvas.height);
                ctx.lineTo(Math.random() * canvas.width, Math.random() * canvas.height);
                ctx.strokeStyle = `rgba(0, 0, 0, ${Math.random() * 0.2 + 0.1})`;
                ctx.stroke();
            }
            for (let i = 0; i < 20; i++) {
                ctx.beginPath();
                ctx.arc(Math.random() * canvas.width, Math.random() * canvas.height, 1, 0, 2 * Math.PI);
                ctx.fillStyle = `rgba(0, 0, 0, ${Math.random() * 0.2 + 0.1})`;
                ctx.fill();
            }
        }

        // Generate word recognition challenge
        function generateWordChallenge() {
            wordOptions.innerHTML = '';
            const realWords = ['apple', 'house', 'tree', 'book', 'car', 'river', 'cloud', 'chair'];
            const realWord = realWords[Math.floor(Math.random() * realWords.length)];
            const nonsenseWords = [
                generateCaptchaText(5),
                generateCaptchaText(6),
                generateCaptchaText(4)
            ];
            const options = [realWord, ...nonsenseWords].sort(() => Math.random() - 0.5);

            options.forEach(word => {
                const btn = document.createElement('button');
                btn.textContent = word;
                btn.className = 'btn btn-outline-dark';
                btn.onclick = () => checkWord(word, realWord);
                wordOptions.appendChild(btn);
            });
        }

        // Check word selection
        function checkWord(selected, realWord) {
            result.textContent = selected === realWord 
                ? 'Word recognition successful.'
                : 'Incorrect word selected. Please try again.';
            result.className = selected === realWord ? 'text-success' : 'text-danger';
            if (selected !== realWord) {
                generateWordChallenge();
            }
        }

        // Check CAPTCHA input
        function checkCaptcha() {
            submitBtn.classList.add('btn-loading');
            submitBtn.disabled = true;
            setTimeout(() => {
                const userInput = captchaInput.value.trim();
                if (userInput === '') {
                    result.textContent = 'Please enter at least one character.';
                    result.className = 'text-danger';
                    submitBtn.classList.remove('btn-loading');
                    submitBtn.disabled = false;
                    return;
                }
                result.textContent = userInput === captchaText 
                    ? 'CAPTCHA verification successful.'
                    : 'Incorrect CAPTCHA text. Please try again.';
                result.className = userInput === captchaText ? 'text-success' : 'text-danger';
                if (userInput !== captchaText) {
                    drawCaptcha();
                    captchaInput.value = '';
                }
                submitBtn.classList.remove('btn-loading');
                submitBtn.disabled = false;
            }, 500); // Simulate processing delay
        }

        // Event listeners
        refreshBtn.addEventListener('click', () => {
            refreshBtn.classList.add('btn-loading');
            setTimeout(() => {
                drawCaptcha();
                captchaInput.value = '';
                result.textContent = '';
                refreshBtn.classList.remove('btn-loading');
            }, 300);
        });

        submitBtn.addEventListener('click', checkCaptcha);

        // Keyboard navigation for accessibility
        captchaInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                checkCaptcha();
            }
        });

        // Initialize CAPTCHA and word challenge
        drawCaptcha();
        generateWordChallenge();
    </script>
</body>
</html>